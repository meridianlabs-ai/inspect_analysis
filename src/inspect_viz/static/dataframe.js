// js/coordinator/coodinator.ts
import {
  wasmConnector,
  Selection,
  Param
} from "https://cdn.jsdelivr.net/npm/@uwdata/mosaic-core@0.16.2/+esm";
import { InstantiateContext } from "https://cdn.jsdelivr.net/npm/@uwdata/mosaic-spec@0.16.2/+esm";

// js/coordinator/duckdb.ts
import {
  getJsDelivrBundles,
  selectBundle,
  AsyncDuckDB,
  ConsoleLogger,
  LogLevel
} from "https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.29.0/+esm";
async function initDuckdb() {
  const JSDELIVR_BUNDLES = getJsDelivrBundles();
  const bundle = await selectBundle(JSDELIVR_BUNDLES);
  const worker_url = URL.createObjectURL(
    new Blob([`importScripts("${bundle.mainWorker}");`], {
      type: "text/javascript"
    })
  );
  const worker = new Worker(worker_url);
  const logger = new ConsoleLogger(LogLevel.INFO);
  const db = new AsyncDuckDB(logger, worker);
  await db.instantiate(bundle.mainModule, bundle.pthreadWorker);
  URL.revokeObjectURL(worker_url);
  return db;
}

// js/coordinator/dataframe.ts
var DataFrame = class {
  constructor(table, selection, queries, params) {
    this.table = table;
    this.selection = selection;
    this.queries = queries;
    this.params = params;
  }
};

// js/util/wait.ts
function sleep(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}

// js/coordinator/select.ts
import {
  SelectQuery,
  eq,
  neq,
  gt,
  gte,
  lt,
  lte,
  and,
  or,
  sum,
  avg,
  min,
  max,
  mode,
  median,
  count,
  add,
  sub,
  mul,
  div,
  BinaryOpNode,
  FunctionNode,
  LiteralNode,
  ParamNode,
  VerbatimNode
} from "https://cdn.jsdelivr.net/npm/@uwdata/mosaic-sql@0.16.2/+esm";
function toSelectQuery(query, params) {
  const selectExpressions = {};
  for (const [alias, expr] of Object.entries(query.select)) {
    selectExpressions[alias] = buildExpressionValue(expr, params);
  }
  let select = SelectQuery.select(selectExpressions);
  if (query.distinct === true) {
    select = select.distinct();
  }
  if (query.where) {
    select = applyWhereClause(select, params, query.where);
  }
  if (query.groupby && query.groupby.length > 0) {
    select = applyGroupByClause(select, params, query.groupby);
  }
  if (query.having) {
    select = applyHavingClause(select, params, query.having);
  }
  if (query.orderby && query.orderby.length > 0) {
    select = applyOrderByClause(select, query.orderby);
  }
  if (query.limit !== null && query.limit !== void 0) {
    select = select.limit(query.limit);
  }
  if (query.sample !== null && query.sample !== void 0) {
    select = select.sample(query.sample);
  }
  return select;
}
function interpretFunction(func, params) {
  const funcName = func.name.toLowerCase();
  const args = func.args.map((a) => buildExpressionNode(a, params));
  switch (funcName) {
    case "sum":
      return sum(args[0]);
    case "avg":
      return avg(args[0]);
    case "min":
      return min(args[0]);
    case "max":
      return max(args[0]);
    case "mode":
      return mode(args[0]);
    case "median":
      return median(args[0]);
    case "count":
      return count(args[0]);
    default:
      return new FunctionNode(funcName, args);
  }
}
function applyWhereClause(query, params, whereExpr) {
  if (whereExpr.type === "and" || whereExpr.type === "or") {
    return applyLogicalExpression(query, params, whereExpr);
  } else if (whereExpr.type === "unknown") {
    return query.where(new VerbatimNode(whereExpr.expression));
  } else {
    const condition = buildBinaryExpression(whereExpr, params);
    return query.where(condition);
  }
}
function applyLogicalExpression(query, params, expr) {
  const { type, expressions } = expr;
  if (expressions.length === 0) {
    return query;
  } else if (expressions.length === 1) {
    return applyWhereClause(
      query,
      params,
      expressions[0]
    );
  } else {
    const conditions = expressions.map((e) => buildExpressionValue(e, params));
    if (type === "and") {
      return query.where(and(...conditions));
    } else {
      return query.where(or(...conditions));
    }
  }
}
function applyGroupByClause(query, params, groupByFields) {
  const fields = groupByFields.map((field) => {
    if (typeof field === "string") {
      return field;
    } else {
      if (typeof field.field === "string") {
        return field.field;
      } else {
        return interpretFunction(field.field, params);
      }
    }
  });
  return query.groupby(...fields);
}
function applyHavingClause(query, params, havingExpr) {
  if ("type" in havingExpr) {
    if (havingExpr.type === "and" || havingExpr.type === "or") {
      const { type, expressions } = havingExpr;
      const conditions = expressions.map((e) => buildExpressionValue(e, params));
      if (type === "and") {
        return query.having(and(...conditions));
      } else {
        return query.having(or(...conditions));
      }
    } else if (havingExpr.type === "unknown") {
      return query.having(new VerbatimNode(havingExpr.expression));
    } else {
      const condition = buildBinaryExpression(havingExpr, params);
      return query.having(condition);
    }
  }
  return query.having(havingExpr);
}
function applyOrderByClause(query, orderByItems) {
  const orderByFields = orderByItems.map((item) => {
    return item.order === "desc" ? `-${item.field}` : item.field;
  });
  return query.orderby(...orderByFields);
}
function buildExpressionNode(expr, params) {
  if (typeof expr === "string" || typeof expr === "number" || typeof expr === "boolean") {
    return new LiteralNode(expr);
  } else if ("type" in expr) {
    if (expr.type === "parameter") {
      const name = expr.name;
      const param = params.get(name);
      if (param === void 0) {
        throw new Error(`Unknown parameter ${name}`);
      }
      return new ParamNode(param);
    } else if (expr.type === "unknown") {
      return new VerbatimNode(expr.expression);
    } else if (expr.type === "function") {
      return interpretFunction(expr, params);
    } else if (expr.type === "and" || expr.type === "or") {
      return buildLogicalExpression(expr, params);
    } else {
      return buildBinaryExpression(expr, params);
    }
  } else {
    throw Error(`Unexpected type for expression: ${typeof expr}`);
  }
}
function buildExpressionValue(expr, params) {
  if (typeof expr === "string") {
    return expr;
  } else {
    return buildExpressionNode(expr, params);
  }
}
function buildLogicalExpression(expr, params) {
  const { type, expressions } = expr;
  if (expressions.length === 0) {
    return new LiteralNode(true);
  } else if (expressions.length === 1) {
    return buildExpressionNode(expressions[0], params);
  } else {
    const conditions = expressions.map((e) => buildExpressionNode(e, params));
    if (type === "and") {
      return and(...conditions);
    } else {
      return or(...conditions);
    }
  }
}
function buildBinaryExpression(expr, params) {
  const { type, left, right } = expr;
  const leftOperand = buildExpressionValue(left, params);
  const rightOperand = buildExpressionNode(right, params);
  switch (type) {
    case "eq":
      return eq(leftOperand, rightOperand);
    case "neq":
      return neq(leftOperand, rightOperand);
    case "gt":
      return gt(leftOperand, rightOperand);
    case "gte":
      return gte(leftOperand, rightOperand);
    case "lt":
      return lt(leftOperand, rightOperand);
    case "lte":
      return lte(leftOperand, rightOperand);
    case "add":
      return add(leftOperand, rightOperand);
    case "sub":
      return sub(leftOperand, rightOperand);
    case "mul":
      return mul(leftOperand, rightOperand);
    case "div":
      return div(leftOperand, rightOperand);
    default:
      return new BinaryOpNode(
        type,
        buildExpressionNode(left, params),
        buildExpressionNode(right, params)
      );
  }
}

// js/coordinator/coodinator.ts
var VizCoordinator = class {
  constructor(conn_) {
    this.conn_ = conn_;
    this.dfs_ = /* @__PURE__ */ new Map();
    this.ctx_ = new InstantiateContext();
    this.ctx_.coordinator.databaseConnector(wasmConnector({ connection: this.conn_ }));
  }
  addParam(name, value) {
    if (!this.ctx_.activeParams.has(name)) {
      this.ctx_.activeParams.set(name, Param.value(value));
    }
    return this.ctx_.activeParams.get(name);
  }
  getParam(name) {
    return this.ctx_.activeParams.get(name);
  }
  async addDataFrame(id, source_id, buffer, queries) {
    if (buffer.length > 0) {
      await this.conn_?.insertArrowFromIPCStream(buffer, {
        name: id,
        create: true
      });
    }
    const params = /* @__PURE__ */ new Map();
    for (const query of queries) {
      for (const p of Object.values(query.parameters)) {
        params.set(p.id, this.addParam(p.id, p.default));
      }
    }
    const df = new DataFrame(
      source_id,
      Selection.intersect(),
      queries.map((q) => toSelectQuery(q, params)),
      params
    );
    this.dfs_.set(id, df);
  }
  async getDataFrame(id) {
    while (true) {
      const df = this.dfs_.get(id);
      if (df) {
        return df;
      } else {
        await sleep(100);
      }
    }
  }
  getInstantiateContext() {
    return this.ctx_;
  }
  async connectClient(client) {
    this.ctx_.coordinator.connect(client);
  }
};
var VIZ_COORDINATOR_KEY = Symbol.for("@@inspect-viz-coordinator");
async function vizCoordinator() {
  const globalScope = typeof window !== "undefined" ? window : globalThis;
  if (!globalScope[VIZ_COORDINATOR_KEY]) {
    globalScope[VIZ_COORDINATOR_KEY] = (async () => {
      const duckdb = await initDuckdb();
      const conn = await duckdb.connect();
      return new VizCoordinator(conn);
    })();
  }
  return globalScope[VIZ_COORDINATOR_KEY];
}

// js/widgets/dataframe.ts
async function render({ model, el }) {
  const id = model.get("id");
  const source_id = model.get("source_id");
  const buffer = model.get("buffer");
  const queries = model.get("queries");
  const dfQueries = queries ? JSON.parse(queries) : [];
  setTimeout(() => {
    const elCellOutput = el.closest(".cell-output");
    if (elCellOutput) {
      elCellOutput.style.display = "none";
    }
  }, 100);
  const coordinator = await vizCoordinator();
  const arrowBuffer = new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);
  await coordinator.addDataFrame(id, source_id, arrowBuffer, dfQueries);
}
var dataframe_default = { render };
export {
  dataframe_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vanMvY29vcmRpbmF0b3IvY29vZGluYXRvci50cyIsICIuLi8uLi8uLi9qcy9jb29yZGluYXRvci9kdWNrZGIudHMiLCAiLi4vLi4vLi4vanMvY29vcmRpbmF0b3IvZGF0YWZyYW1lLnRzIiwgIi4uLy4uLy4uL2pzL3V0aWwvd2FpdC50cyIsICIuLi8uLi8uLi9qcy9jb29yZGluYXRvci9zZWxlY3QudHMiLCAiLi4vLi4vLi4vanMvd2lkZ2V0cy9kYXRhZnJhbWUudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IEFzeW5jRHVja0RCQ29ubmVjdGlvbiB9IGZyb20gJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vQGR1Y2tkYi9kdWNrZGItd2FzbUAxLjI5LjAvK2VzbSc7XG5cbmltcG9ydCB7XG4gICAgTW9zYWljQ2xpZW50LFxuICAgIHdhc21Db25uZWN0b3IsXG4gICAgU2VsZWN0aW9uLFxuICAgIFBhcmFtLFxufSBmcm9tICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL0B1d2RhdGEvbW9zYWljLWNvcmVAMC4xNi4yLytlc20nO1xuXG5pbXBvcnQgeyBJbnN0YW50aWF0ZUNvbnRleHQgfSBmcm9tICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL0B1d2RhdGEvbW9zYWljLXNwZWNAMC4xNi4yLytlc20nO1xuXG5pbXBvcnQgeyBpbml0RHVja2RiIH0gZnJvbSAnLi9kdWNrZGInO1xuaW1wb3J0IHsgTW9zYWljUXVlcnkgfSBmcm9tICcuL3F1ZXJ5JztcbmltcG9ydCB7IERhdGFGcmFtZSB9IGZyb20gJy4vZGF0YWZyYW1lJztcbmltcG9ydCB7IHNsZWVwIH0gZnJvbSAnLi4vdXRpbC93YWl0JztcbmltcG9ydCB7IHRvU2VsZWN0UXVlcnkgfSBmcm9tICcuL3NlbGVjdCc7XG5cbmNsYXNzIFZpekNvb3JkaW5hdG9yIHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGN0eF86IEluc3RhbnRpYXRlQ29udGV4dDtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRmc18gPSBuZXcgTWFwPHN0cmluZywgRGF0YUZyYW1lPigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjb25uXzogQXN5bmNEdWNrREJDb25uZWN0aW9uKSB7XG4gICAgICAgIHRoaXMuY3R4XyA9IG5ldyBJbnN0YW50aWF0ZUNvbnRleHQoKTtcbiAgICAgICAgdGhpcy5jdHhfLmNvb3JkaW5hdG9yLmRhdGFiYXNlQ29ubmVjdG9yKHdhc21Db25uZWN0b3IoeyBjb25uZWN0aW9uOiB0aGlzLmNvbm5fIH0pKTtcbiAgICB9XG5cbiAgICBhZGRQYXJhbShuYW1lOiBzdHJpbmcsIHZhbHVlOiBudW1iZXIgfCBib29sZWFuIHwgc3RyaW5nKTogUGFyYW0ge1xuICAgICAgICBpZiAoIXRoaXMuY3R4Xy5hY3RpdmVQYXJhbXMuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLmN0eF8uYWN0aXZlUGFyYW1zLnNldChuYW1lLCBQYXJhbS52YWx1ZSh2YWx1ZSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmN0eF8uYWN0aXZlUGFyYW1zLmdldChuYW1lKSE7XG4gICAgfVxuXG4gICAgZ2V0UGFyYW0obmFtZTogc3RyaW5nKTogUGFyYW0gfCB1bmRlZmluZWQge1xuICAgICAgICByZXR1cm4gdGhpcy5jdHhfLmFjdGl2ZVBhcmFtcy5nZXQobmFtZSk7XG4gICAgfVxuXG4gICAgYXN5bmMgYWRkRGF0YUZyYW1lKGlkOiBzdHJpbmcsIHNvdXJjZV9pZDogc3RyaW5nLCBidWZmZXI6IFVpbnQ4QXJyYXksIHF1ZXJpZXM6IE1vc2FpY1F1ZXJ5W10pIHtcbiAgICAgICAgLy8gaW5zZXJ0IHRhYmxlIGludG8gZGF0YWJhc2UgaWYgdGhlcmUgaXMgZGF0YVxuICAgICAgICBpZiAoYnVmZmVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY29ubl8/Lmluc2VydEFycm93RnJvbUlQQ1N0cmVhbShidWZmZXIsIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBpZCxcbiAgICAgICAgICAgICAgICBjcmVhdGU6IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGV4dHJhY3QgcGFyYW1ldGVycyBmcm9tIHF1ZXJpZXMgYW5kIHJlZ2lzdGVyIHRoZW1cbiAgICAgICAgY29uc3QgcGFyYW1zID0gbmV3IE1hcDxzdHJpbmcsIFBhcmFtPigpO1xuICAgICAgICBmb3IgKGNvbnN0IHF1ZXJ5IG9mIHF1ZXJpZXMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcCBvZiBPYmplY3QudmFsdWVzKHF1ZXJ5LnBhcmFtZXRlcnMpKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnNldChwLmlkLCB0aGlzLmFkZFBhcmFtKHAuaWQsIHAuZGVmYXVsdCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gY3JlYXRlIGFuZCByZWdpc3RlciBkZlxuICAgICAgICBjb25zdCBkZiA9IG5ldyBEYXRhRnJhbWUoXG4gICAgICAgICAgICBzb3VyY2VfaWQsXG4gICAgICAgICAgICBTZWxlY3Rpb24uaW50ZXJzZWN0KCksXG4gICAgICAgICAgICBxdWVyaWVzLm1hcChxID0+IHRvU2VsZWN0UXVlcnkocSwgcGFyYW1zKSksXG4gICAgICAgICAgICBwYXJhbXNcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5kZnNfLnNldChpZCwgZGYpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldERhdGFGcmFtZShpZDogc3RyaW5nKSB7XG4gICAgICAgIC8vIGF0IHN0YXJ0dXAgd2UgY2FuJ3QgY29udHJvbCB0aGUgb3JkZXIgb2YgZGYgcHJvZHVjaW5nIGFuZCBkZiBjb25zdW1pbmdcbiAgICAgICAgLy8gd2lkZ2V0cywgc28gd2UgbWF5IG5lZWQgdG8gd2FpdCBhbmQgcmV0cnkgZm9yIHRoZSBkYXRhIGZyYW1lXG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICBjb25zdCBkZiA9IHRoaXMuZGZzXy5nZXQoaWQpO1xuICAgICAgICAgICAgaWYgKGRmKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRmO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzbGVlcCgxMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0SW5zdGFudGlhdGVDb250ZXh0KCk6IEluc3RhbnRpYXRlQ29udGV4dCB7XG4gICAgICAgIHJldHVybiB0aGlzLmN0eF87XG4gICAgfVxuXG4gICAgYXN5bmMgY29ubmVjdENsaWVudChjbGllbnQ6IE1vc2FpY0NsaWVudCkge1xuICAgICAgICB0aGlzLmN0eF8uY29vcmRpbmF0b3IuY29ubmVjdChjbGllbnQpO1xuICAgIH1cbn1cblxuLy8gZ2V0IHRoZSBnbG9iYWwgY29vcmRpbmF0b3JzIGluc3RhbmNlLCBlbnN1cmluZyB3ZSBnZXQgdGhlIHNhbWVcbi8vIGluc3RhbmNlIGV2YWwgYWNyb3NzIGRpZmZlcmVudCBqcyBidW5kbGVzIGxvYWRlZCBpbnRvIHRoZSBwYWdlXG5jb25zdCBWSVpfQ09PUkRJTkFUT1JfS0VZID0gU3ltYm9sLmZvcignQEBpbnNwZWN0LXZpei1jb29yZGluYXRvcicpO1xuYXN5bmMgZnVuY3Rpb24gdml6Q29vcmRpbmF0b3IoKTogUHJvbWlzZTxWaXpDb29yZGluYXRvcj4ge1xuICAgIGNvbnN0IGdsb2JhbFNjb3BlOiBhbnkgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IGdsb2JhbFRoaXM7XG4gICAgaWYgKCFnbG9iYWxTY29wZVtWSVpfQ09PUkRJTkFUT1JfS0VZXSkge1xuICAgICAgICBnbG9iYWxTY29wZVtWSVpfQ09PUkRJTkFUT1JfS0VZXSA9IChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkdWNrZGIgPSBhd2FpdCBpbml0RHVja2RiKCk7XG4gICAgICAgICAgICBjb25zdCBjb25uID0gYXdhaXQgZHVja2RiLmNvbm5lY3QoKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVml6Q29vcmRpbmF0b3IoY29ubik7XG4gICAgICAgIH0pKCk7XG4gICAgfVxuICAgIHJldHVybiBnbG9iYWxTY29wZVtWSVpfQ09PUkRJTkFUT1JfS0VZXSBhcyBQcm9taXNlPFZpekNvb3JkaW5hdG9yPjtcbn1cblxuZXhwb3J0IHsgVml6Q29vcmRpbmF0b3IsIHZpekNvb3JkaW5hdG9yIH07XG4iLCAiaW1wb3J0IHtcbiAgICBnZXRKc0RlbGl2ckJ1bmRsZXMsXG4gICAgc2VsZWN0QnVuZGxlLFxuICAgIEFzeW5jRHVja0RCLFxuICAgIENvbnNvbGVMb2dnZXIsXG4gICAgQXN5bmNEdWNrREJDb25uZWN0aW9uLFxuICAgIExvZ0xldmVsLFxufSBmcm9tICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL0BkdWNrZGIvZHVja2RiLXdhc21AMS4yOS4wLytlc20nO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdER1Y2tkYigpIHtcbiAgICBjb25zdCBKU0RFTElWUl9CVU5ETEVTID0gZ2V0SnNEZWxpdnJCdW5kbGVzKCk7XG5cbiAgICAvLyBTZWxlY3QgYSBidW5kbGUgYmFzZWQgb24gYnJvd3NlciBjaGVja3NcbiAgICBjb25zdCBidW5kbGUgPSBhd2FpdCBzZWxlY3RCdW5kbGUoSlNERUxJVlJfQlVORExFUyk7XG5cbiAgICBjb25zdCB3b3JrZXJfdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChcbiAgICAgICAgbmV3IEJsb2IoW2BpbXBvcnRTY3JpcHRzKFwiJHtidW5kbGUubWFpbldvcmtlciF9XCIpO2BdLCB7XG4gICAgICAgICAgICB0eXBlOiAndGV4dC9qYXZhc2NyaXB0JyxcbiAgICAgICAgfSlcbiAgICApO1xuXG4gICAgLy8gSW5zdGFudGlhdGUgdGhlIGFzeW5jaHJvbm91cyB2ZXJzaW9uIG9mIER1Y2tEQi13YXNtXG4gICAgY29uc3Qgd29ya2VyID0gbmV3IFdvcmtlcih3b3JrZXJfdXJsKTtcbiAgICBjb25zdCBsb2dnZXIgPSBuZXcgQ29uc29sZUxvZ2dlcihMb2dMZXZlbC5JTkZPKTtcbiAgICBjb25zdCBkYiA9IG5ldyBBc3luY0R1Y2tEQihsb2dnZXIsIHdvcmtlcik7XG4gICAgYXdhaXQgZGIuaW5zdGFudGlhdGUoYnVuZGxlLm1haW5Nb2R1bGUsIGJ1bmRsZS5wdGhyZWFkV29ya2VyKTtcbiAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHdvcmtlcl91cmwpO1xuXG4gICAgcmV0dXJuIGRiO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gd2FpdEZvclRhYmxlKFxuICAgIGNvbm46IEFzeW5jRHVja0RCQ29ubmVjdGlvbixcbiAgICB0YWJsZTogc3RyaW5nLFxuICAgIHsgdGltZW91dCA9IDEwXzAwMCwgaW50ZXJ2YWwgPSAyNTAgfSA9IHt9XG4pIHtcbiAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNvbm4ucXVlcnkoXG4gICAgICAgICAgICAgICAgYFNFTEVDVCAxXG4gICAgICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLnRhYmxlc1xuICAgICAgICAgV0hFUkUgdGFibGVfc2NoZW1hID0gJ21haW4nXG4gICAgICAgICAgIEFORCB0YWJsZV9uYW1lICAgPSAnJHt0YWJsZX0nXG4gICAgICAgICBMSU1JVCAxYFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKHJlcy5udW1Sb3dzKSByZXR1cm47IC8vIHN1Y2Nlc3MgXHUyNzI4XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgLyogVGFibGUgb3IgZXZlbiB0aGUgZGF0YWJhc2UgZmlsZSBtYXkgbm90IGJlIHJlYWR5IHlldC5cbiAgICAgICAgIElnbm9yZSB0aGUgZXJyb3IgYW5kIGtlZXAgcG9sbGluZy4gKi9cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwZXJmb3JtYW5jZS5ub3coKSAtIHQwID4gdGltZW91dCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaW1lZCBvdXQgd2FpdGluZyBmb3IgdGFibGUgXCIke3RhYmxlfVwiYCk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIGludGVydmFsKSk7XG4gICAgfVxufVxuIiwgImltcG9ydCB7IFBhcmFtLCBTZWxlY3Rpb24gfSBmcm9tICdAdXdkYXRhL21vc2FpYy1jb3JlJztcbmltcG9ydCB7IFNlbGVjdFF1ZXJ5IH0gZnJvbSAnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9AdXdkYXRhL21vc2FpYy1zcWxAMC4xNi4yLytlc20nO1xuXG5leHBvcnQgY2xhc3MgRGF0YUZyYW1lIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IHRhYmxlOiBzdHJpbmcsXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBzZWxlY3Rpb246IFNlbGVjdGlvbixcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IHF1ZXJpZXM6IFNlbGVjdFF1ZXJ5W10sXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBwYXJhbXM6IE1hcDxzdHJpbmcsIFBhcmFtPlxuICAgICkge31cbn1cbiIsICJleHBvcnQgZnVuY3Rpb24gc2xlZXAobXM6IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbn1cbiIsICJpbXBvcnQge1xuICAgIFNlbGVjdFF1ZXJ5LFxuICAgIGVxLFxuICAgIG5lcSxcbiAgICBndCxcbiAgICBndGUsXG4gICAgbHQsXG4gICAgbHRlLFxuICAgIGFuZCxcbiAgICBvcixcbiAgICBzdW0sXG4gICAgYXZnLFxuICAgIG1pbixcbiAgICBtYXgsXG4gICAgbW9kZSxcbiAgICBtZWRpYW4sXG4gICAgY291bnQsXG4gICAgYWRkLFxuICAgIHN1YixcbiAgICBtdWwsXG4gICAgZGl2LFxuICAgIEJpbmFyeU9wTm9kZSxcbiAgICBBZ2dyZWdhdGVOb2RlLFxuICAgIEV4cHJWYWx1ZSxcbiAgICBGdW5jdGlvbk5vZGUsXG4gICAgRXhwck5vZGUsXG4gICAgTGl0ZXJhbE5vZGUsXG4gICAgUGFyYW1Ob2RlLFxuICAgIFZlcmJhdGltTm9kZSxcbn0gZnJvbSAnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9AdXdkYXRhL21vc2FpYy1zcWxAMC4xNi4yLytlc20nO1xuXG5pbXBvcnQge1xuICAgIE1vc2FpY1F1ZXJ5LFxuICAgIEJpbmFyeUV4cHJlc3Npb24sXG4gICAgTG9naWNhbEV4cHJlc3Npb24sXG4gICAgRnVuY3Rpb25FeHByZXNzaW9uLFxuICAgIFVua25vd25FeHByZXNzaW9uLFxuICAgIFBhcmFtZXRlckV4cHJlc3Npb24sXG4gICAgT3JkZXJCeUl0ZW0sXG4gICAgR3JvdXBCeUZpZWxkLFxuICAgIEV4cHJlc3Npb24sXG59IGZyb20gJy4vcXVlcnknO1xuaW1wb3J0IHsgUGFyYW0gfSBmcm9tICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL0B1d2RhdGEvbW9zYWljLWNvcmVAMC4xNi4yLytlc20nO1xuXG5leHBvcnQgZnVuY3Rpb24gdG9TZWxlY3RRdWVyeShxdWVyeTogTW9zYWljUXVlcnksIHBhcmFtczogTWFwPHN0cmluZywgUGFyYW0+KTogU2VsZWN0UXVlcnkge1xuICAgIC8vIGNvbnZlcnQgdG8gZXhwcmVzc2lvbnNcbiAgICBjb25zdCBzZWxlY3RFeHByZXNzaW9uczogUmVjb3JkPHN0cmluZywgRXhwclZhbHVlPiA9IHt9O1xuICAgIGZvciAoY29uc3QgW2FsaWFzLCBleHByXSBvZiBPYmplY3QuZW50cmllcyhxdWVyeS5zZWxlY3QpKSB7XG4gICAgICAgIHNlbGVjdEV4cHJlc3Npb25zW2FsaWFzXSA9IGJ1aWxkRXhwcmVzc2lvblZhbHVlKGV4cHIsIHBhcmFtcyk7XG4gICAgfVxuICAgIGxldCBzZWxlY3QgPSBTZWxlY3RRdWVyeS5zZWxlY3Qoc2VsZWN0RXhwcmVzc2lvbnMpO1xuXG4gICAgLy8gQXBwbHkgRElTVElOQ1QgaWYgbmVlZGVkXG4gICAgaWYgKHF1ZXJ5LmRpc3RpbmN0ID09PSB0cnVlKSB7XG4gICAgICAgIHNlbGVjdCA9IHNlbGVjdC5kaXN0aW5jdCgpO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IFdIRVJFIGNsYXVzZSBpZiBwcmVzZW50XG4gICAgaWYgKHF1ZXJ5LndoZXJlKSB7XG4gICAgICAgIHNlbGVjdCA9IGFwcGx5V2hlcmVDbGF1c2Uoc2VsZWN0LCBwYXJhbXMsIHF1ZXJ5LndoZXJlKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBHUk9VUCBCWSBjbGF1c2UgaWYgcHJlc2VudFxuICAgIGlmIChxdWVyeS5ncm91cGJ5ICYmIHF1ZXJ5Lmdyb3VwYnkubGVuZ3RoID4gMCkge1xuICAgICAgICBzZWxlY3QgPSBhcHBseUdyb3VwQnlDbGF1c2Uoc2VsZWN0LCBwYXJhbXMsIHF1ZXJ5Lmdyb3VwYnkpO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IEhBVklORyBjbGF1c2UgaWYgcHJlc2VudFxuICAgIGlmIChxdWVyeS5oYXZpbmcpIHtcbiAgICAgICAgc2VsZWN0ID0gYXBwbHlIYXZpbmdDbGF1c2Uoc2VsZWN0LCBwYXJhbXMsIHF1ZXJ5LmhhdmluZyk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgT1JERVIgQlkgY2xhdXNlIGlmIHByZXNlbnRcbiAgICBpZiAocXVlcnkub3JkZXJieSAmJiBxdWVyeS5vcmRlcmJ5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgc2VsZWN0ID0gYXBwbHlPcmRlckJ5Q2xhdXNlKHNlbGVjdCwgcXVlcnkub3JkZXJieSk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgTElNSVQgY2xhdXNlIGlmIHByZXNlbnRcbiAgICBpZiAocXVlcnkubGltaXQgIT09IG51bGwgJiYgcXVlcnkubGltaXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzZWxlY3QgPSBzZWxlY3QubGltaXQocXVlcnkubGltaXQpO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IFNBTVBMRSBjbGF1c2UgaWYgcHJlc2VudFxuICAgIGlmIChxdWVyeS5zYW1wbGUgIT09IG51bGwgJiYgcXVlcnkuc2FtcGxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgc2VsZWN0ID0gc2VsZWN0LnNhbXBsZShxdWVyeS5zYW1wbGUpO1xuICAgIH1cblxuICAgIHJldHVybiBzZWxlY3Q7XG59XG5cbmZ1bmN0aW9uIGludGVycHJldEZ1bmN0aW9uKFxuICAgIGZ1bmM6IEZ1bmN0aW9uRXhwcmVzc2lvbixcbiAgICBwYXJhbXM6IE1hcDxzdHJpbmcsIFBhcmFtPlxuKTogQWdncmVnYXRlTm9kZSB8IEZ1bmN0aW9uTm9kZSB7XG4gICAgY29uc3QgZnVuY05hbWUgPSBmdW5jLm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBhcmdzOiBFeHByTm9kZVtdID0gZnVuYy5hcmdzLm1hcChhID0+IGJ1aWxkRXhwcmVzc2lvbk5vZGUoYSwgcGFyYW1zKSk7XG5cbiAgICAvLyBIYW5kbGUgY29tbW9uIGFnZ3JlZ2F0ZSBmdW5jdGlvbnMgZGlyZWN0bHlcbiAgICBzd2l0Y2ggKGZ1bmNOYW1lKSB7XG4gICAgICAgIGNhc2UgJ3N1bSc6XG4gICAgICAgICAgICByZXR1cm4gc3VtKGFyZ3NbMF0pO1xuICAgICAgICBjYXNlICdhdmcnOlxuICAgICAgICAgICAgcmV0dXJuIGF2ZyhhcmdzWzBdKTtcbiAgICAgICAgY2FzZSAnbWluJzpcbiAgICAgICAgICAgIHJldHVybiBtaW4oYXJnc1swXSk7XG4gICAgICAgIGNhc2UgJ21heCc6XG4gICAgICAgICAgICByZXR1cm4gbWF4KGFyZ3NbMF0pO1xuICAgICAgICBjYXNlICdtb2RlJzpcbiAgICAgICAgICAgIHJldHVybiBtb2RlKGFyZ3NbMF0pO1xuICAgICAgICBjYXNlICdtZWRpYW4nOlxuICAgICAgICAgICAgcmV0dXJuIG1lZGlhbihhcmdzWzBdKTtcbiAgICAgICAgY2FzZSAnY291bnQnOlxuICAgICAgICAgICAgcmV0dXJuIGNvdW50KGFyZ3NbMF0pO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgLy8gRm9yIG90aGVyIGZ1bmN0aW9ucywgdXNlIGEgZ2VuZXJpYyBhcHByb2FjaFxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbk5vZGUoZnVuY05hbWUsIGFyZ3MpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gYXBwbHlXaGVyZUNsYXVzZShcbiAgICBxdWVyeTogU2VsZWN0UXVlcnksXG4gICAgcGFyYW1zOiBNYXA8c3RyaW5nLCBQYXJhbT4sXG4gICAgd2hlcmVFeHByOiBCaW5hcnlFeHByZXNzaW9uIHwgTG9naWNhbEV4cHJlc3Npb24gfCBVbmtub3duRXhwcmVzc2lvblxuKTogU2VsZWN0UXVlcnkge1xuICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgZXhwcmVzc2lvbiB0eXBlc1xuICAgIGlmICh3aGVyZUV4cHIudHlwZSA9PT0gJ2FuZCcgfHwgd2hlcmVFeHByLnR5cGUgPT09ICdvcicpIHtcbiAgICAgICAgLy8gTG9naWNhbCBBTkQvT1IgZXhwcmVzc2lvblxuICAgICAgICByZXR1cm4gYXBwbHlMb2dpY2FsRXhwcmVzc2lvbihxdWVyeSwgcGFyYW1zLCB3aGVyZUV4cHIgYXMgTG9naWNhbEV4cHJlc3Npb24pO1xuICAgIH0gZWxzZSBpZiAod2hlcmVFeHByLnR5cGUgPT09ICd1bmtub3duJykge1xuICAgICAgICAvLyBVbmtub3duIGV4cHJlc3Npb24gLSBwYXNzIHJhdyBTUUxcbiAgICAgICAgcmV0dXJuIHF1ZXJ5LndoZXJlKG5ldyBWZXJiYXRpbU5vZGUoKHdoZXJlRXhwciBhcyBVbmtub3duRXhwcmVzc2lvbikuZXhwcmVzc2lvbikpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IGJ1aWxkQmluYXJ5RXhwcmVzc2lvbih3aGVyZUV4cHIgYXMgQmluYXJ5RXhwcmVzc2lvbiwgcGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIHF1ZXJ5LndoZXJlKGNvbmRpdGlvbik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhcHBseUxvZ2ljYWxFeHByZXNzaW9uKFxuICAgIHF1ZXJ5OiBTZWxlY3RRdWVyeSxcbiAgICBwYXJhbXM6IE1hcDxzdHJpbmcsIFBhcmFtPixcbiAgICBleHByOiBMb2dpY2FsRXhwcmVzc2lvblxuKTogU2VsZWN0UXVlcnkge1xuICAgIGNvbnN0IHsgdHlwZSwgZXhwcmVzc2lvbnMgfSA9IGV4cHI7XG5cbiAgICBpZiAoZXhwcmVzc2lvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBxdWVyeTtcbiAgICB9IGVsc2UgaWYgKGV4cHJlc3Npb25zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICByZXR1cm4gYXBwbHlXaGVyZUNsYXVzZShcbiAgICAgICAgICAgIHF1ZXJ5LFxuICAgICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgICAgZXhwcmVzc2lvbnNbMF0gYXMgQmluYXJ5RXhwcmVzc2lvbiB8IExvZ2ljYWxFeHByZXNzaW9uIHwgVW5rbm93bkV4cHJlc3Npb25cbiAgICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjb25kaXRpb25zID0gZXhwcmVzc2lvbnMubWFwKGUgPT4gYnVpbGRFeHByZXNzaW9uVmFsdWUoZSwgcGFyYW1zKSk7XG4gICAgICAgIGlmICh0eXBlID09PSAnYW5kJykge1xuICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5LndoZXJlKGFuZCguLi5jb25kaXRpb25zKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcXVlcnkud2hlcmUob3IoLi4uY29uZGl0aW9ucykpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhcHBseUdyb3VwQnlDbGF1c2UoXG4gICAgcXVlcnk6IFNlbGVjdFF1ZXJ5LFxuICAgIHBhcmFtczogTWFwPHN0cmluZywgUGFyYW0+LFxuICAgIGdyb3VwQnlGaWVsZHM6IChzdHJpbmcgfCBHcm91cEJ5RmllbGQpW11cbik6IFNlbGVjdFF1ZXJ5IHtcbiAgICBjb25zdCBmaWVsZHMgPSBncm91cEJ5RmllbGRzLm1hcChmaWVsZCA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgZmllbGQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gZmllbGQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBHcm91cEJ5RmllbGQgb2JqZWN0XG4gICAgICAgICAgICBpZiAodHlwZW9mIGZpZWxkLmZpZWxkID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5maWVsZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gRnVuY3Rpb24gZXhwcmVzc2lvbiBpbiBHUk9VUCBCWVxuICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcnByZXRGdW5jdGlvbihmaWVsZC5maWVsZCwgcGFyYW1zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHF1ZXJ5Lmdyb3VwYnkoLi4uZmllbGRzKTtcbn1cblxuZnVuY3Rpb24gYXBwbHlIYXZpbmdDbGF1c2UoXG4gICAgcXVlcnk6IFNlbGVjdFF1ZXJ5LFxuICAgIHBhcmFtczogTWFwPHN0cmluZywgUGFyYW0+LFxuICAgIGhhdmluZ0V4cHI6IEJpbmFyeUV4cHJlc3Npb24gfCBMb2dpY2FsRXhwcmVzc2lvbiB8IFVua25vd25FeHByZXNzaW9uXG4pOiBTZWxlY3RRdWVyeSB7XG4gICAgLy8gSGF2aW5nIGNsYXVzZXMgYXJlIHNpbWlsYXIgdG8gV0hFUkUgY2xhdXNlc1xuICAgIGlmICgndHlwZScgaW4gaGF2aW5nRXhwcikge1xuICAgICAgICAvLyBIYW5kbGUgZGlmZmVyZW50IGV4cHJlc3Npb24gdHlwZXNcbiAgICAgICAgaWYgKGhhdmluZ0V4cHIudHlwZSA9PT0gJ2FuZCcgfHwgaGF2aW5nRXhwci50eXBlID09PSAnb3InKSB7XG4gICAgICAgICAgICAvLyBMb2dpY2FsIEFORC9PUiBleHByZXNzaW9uXG4gICAgICAgICAgICBjb25zdCB7IHR5cGUsIGV4cHJlc3Npb25zIH0gPSBoYXZpbmdFeHByIGFzIExvZ2ljYWxFeHByZXNzaW9uO1xuXG4gICAgICAgICAgICAvLyBCdWlsZCB0aGUgY29uZGl0aW9ucyBhcnJheVxuICAgICAgICAgICAgY29uc3QgY29uZGl0aW9ucyA9IGV4cHJlc3Npb25zLm1hcChlID0+IGJ1aWxkRXhwcmVzc2lvblZhbHVlKGUsIHBhcmFtcykpO1xuXG4gICAgICAgICAgICAvLyBBcHBseSB0aGUgY29uZGl0aW9ucyB1c2luZyB0aGUgYXBwcm9wcmlhdGUgbG9naWNhbCBvcGVyYXRvclxuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdhbmQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5LmhhdmluZyhhbmQoLi4uY29uZGl0aW9ucykpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXVlcnkuaGF2aW5nKG9yKC4uLmNvbmRpdGlvbnMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChoYXZpbmdFeHByLnR5cGUgPT09ICd1bmtub3duJykge1xuICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5LmhhdmluZyhuZXcgVmVyYmF0aW1Ob2RlKChoYXZpbmdFeHByIGFzIFVua25vd25FeHByZXNzaW9uKS5leHByZXNzaW9uKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBCaW5hcnkgZXhwcmVzc2lvbiAoY29tcGFyaXNvbilcbiAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IGJ1aWxkQmluYXJ5RXhwcmVzc2lvbihoYXZpbmdFeHByIGFzIEJpbmFyeUV4cHJlc3Npb24sIHBhcmFtcyk7XG4gICAgICAgICAgICByZXR1cm4gcXVlcnkuaGF2aW5nKGNvbmRpdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjayAtIGp1c3QgcGFzcyB0aGUgZXhwcmVzc2lvbiBhcyBpc1xuICAgIHJldHVybiBxdWVyeS5oYXZpbmcoaGF2aW5nRXhwcik7XG59XG5cbmZ1bmN0aW9uIGFwcGx5T3JkZXJCeUNsYXVzZShxdWVyeTogU2VsZWN0UXVlcnksIG9yZGVyQnlJdGVtczogT3JkZXJCeUl0ZW1bXSk6IFNlbGVjdFF1ZXJ5IHtcbiAgICAvLyBVc2luZyBzdHJpbmcgcHJlZml4aW5nIGZvciBkZXNjZW5kaW5nIG9yZGVyIGFzIHRoYXQncyB3aGF0IE1vc2FpYyBTUUwgc3VwcG9ydHNcbiAgICBjb25zdCBvcmRlckJ5RmllbGRzID0gb3JkZXJCeUl0ZW1zLm1hcChpdGVtID0+IHtcbiAgICAgICAgcmV0dXJuIGl0ZW0ub3JkZXIgPT09ICdkZXNjJyA/IGAtJHtpdGVtLmZpZWxkfWAgOiBpdGVtLmZpZWxkO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHF1ZXJ5Lm9yZGVyYnkoLi4ub3JkZXJCeUZpZWxkcyk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRXhwcmVzc2lvbk5vZGUoZXhwcjogRXhwcmVzc2lvbiwgcGFyYW1zOiBNYXA8c3RyaW5nLCBQYXJhbT4pOiBFeHByTm9kZSB7XG4gICAgaWYgKHR5cGVvZiBleHByID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgZXhwciA9PT0gJ251bWJlcicgfHwgdHlwZW9mIGV4cHIgPT09ICdib29sZWFuJykge1xuICAgICAgICByZXR1cm4gbmV3IExpdGVyYWxOb2RlKGV4cHIpO1xuICAgIH0gZWxzZSBpZiAoJ3R5cGUnIGluIGV4cHIpIHtcbiAgICAgICAgaWYgKGV4cHIudHlwZSA9PT0gJ3BhcmFtZXRlcicpIHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSAoZXhwciBhcyBQYXJhbWV0ZXJFeHByZXNzaW9uKS5uYW1lO1xuICAgICAgICAgICAgY29uc3QgcGFyYW0gPSBwYXJhbXMuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgaWYgKHBhcmFtID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gcGFyYW1ldGVyICR7bmFtZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUGFyYW1Ob2RlKHBhcmFtKTtcbiAgICAgICAgfSBlbHNlIGlmIChleHByLnR5cGUgPT09ICd1bmtub3duJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZXJiYXRpbU5vZGUoKGV4cHIgYXMgVW5rbm93bkV4cHJlc3Npb24pLmV4cHJlc3Npb24pO1xuICAgICAgICB9IGVsc2UgaWYgKGV4cHIudHlwZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIGludGVycHJldEZ1bmN0aW9uKGV4cHIgYXMgRnVuY3Rpb25FeHByZXNzaW9uLCBwYXJhbXMpO1xuICAgICAgICB9IGVsc2UgaWYgKGV4cHIudHlwZSA9PT0gJ2FuZCcgfHwgZXhwci50eXBlID09PSAnb3InKSB7XG4gICAgICAgICAgICByZXR1cm4gYnVpbGRMb2dpY2FsRXhwcmVzc2lvbihleHByIGFzIExvZ2ljYWxFeHByZXNzaW9uLCBwYXJhbXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGJ1aWxkQmluYXJ5RXhwcmVzc2lvbihleHByIGFzIEJpbmFyeUV4cHJlc3Npb24sIHBhcmFtcyk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBFcnJvcihgVW5leHBlY3RlZCB0eXBlIGZvciBleHByZXNzaW9uOiAke3R5cGVvZiBleHByfWApO1xuICAgIH1cbn1cblxuLy8gVE9ETzogXCIqXCIgaXMgZ2V0dGluZyBwYXJzZWQgYXMgdW5rbm93blxuZnVuY3Rpb24gYnVpbGRFeHByZXNzaW9uVmFsdWUoZXhwcjogRXhwcmVzc2lvbiwgcGFyYW1zOiBNYXA8c3RyaW5nLCBQYXJhbT4pOiBFeHByVmFsdWUge1xuICAgIGlmICh0eXBlb2YgZXhwciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIGV4cHI7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGJ1aWxkRXhwcmVzc2lvbk5vZGUoZXhwciwgcGFyYW1zKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGJ1aWxkTG9naWNhbEV4cHJlc3Npb24oZXhwcjogTG9naWNhbEV4cHJlc3Npb24sIHBhcmFtczogTWFwPHN0cmluZywgUGFyYW0+KTogRXhwck5vZGUge1xuICAgIGNvbnN0IHsgdHlwZSwgZXhwcmVzc2lvbnMgfSA9IGV4cHI7XG5cbiAgICBpZiAoZXhwcmVzc2lvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBuZXcgTGl0ZXJhbE5vZGUodHJ1ZSk7XG4gICAgfSBlbHNlIGlmIChleHByZXNzaW9ucy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGJ1aWxkRXhwcmVzc2lvbk5vZGUoZXhwcmVzc2lvbnNbMF0sIHBhcmFtcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgY29uZGl0aW9ucyA9IGV4cHJlc3Npb25zLm1hcChlID0+IGJ1aWxkRXhwcmVzc2lvbk5vZGUoZSwgcGFyYW1zKSk7XG4gICAgICAgIGlmICh0eXBlID09PSAnYW5kJykge1xuICAgICAgICAgICAgcmV0dXJuIGFuZCguLi5jb25kaXRpb25zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBvciguLi5jb25kaXRpb25zKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gYnVpbGRCaW5hcnlFeHByZXNzaW9uKGV4cHI6IEJpbmFyeUV4cHJlc3Npb24sIHBhcmFtczogTWFwPHN0cmluZywgUGFyYW0+KTogQmluYXJ5T3BOb2RlIHtcbiAgICBjb25zdCB7IHR5cGUsIGxlZnQsIHJpZ2h0IH0gPSBleHByO1xuXG4gICAgY29uc3QgbGVmdE9wZXJhbmQgPSBidWlsZEV4cHJlc3Npb25WYWx1ZShsZWZ0LCBwYXJhbXMpO1xuICAgIGNvbnN0IHJpZ2h0T3BlcmFuZCA9IGJ1aWxkRXhwcmVzc2lvbk5vZGUocmlnaHQsIHBhcmFtcyk7XG5cbiAgICAvLyBNYXAgY29tbW9uIGNvbXBhcmlzb24gb3BlcmF0b3JzIHRvIE1vc2FpYyBTUUwgbWV0aG9kc1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICdlcSc6XG4gICAgICAgICAgICByZXR1cm4gZXEobGVmdE9wZXJhbmQsIHJpZ2h0T3BlcmFuZCk7XG4gICAgICAgIGNhc2UgJ25lcSc6XG4gICAgICAgICAgICByZXR1cm4gbmVxKGxlZnRPcGVyYW5kLCByaWdodE9wZXJhbmQpO1xuICAgICAgICBjYXNlICdndCc6XG4gICAgICAgICAgICByZXR1cm4gZ3QobGVmdE9wZXJhbmQsIHJpZ2h0T3BlcmFuZCk7XG4gICAgICAgIGNhc2UgJ2d0ZSc6XG4gICAgICAgICAgICByZXR1cm4gZ3RlKGxlZnRPcGVyYW5kLCByaWdodE9wZXJhbmQpO1xuICAgICAgICBjYXNlICdsdCc6XG4gICAgICAgICAgICByZXR1cm4gbHQobGVmdE9wZXJhbmQsIHJpZ2h0T3BlcmFuZCk7XG4gICAgICAgIGNhc2UgJ2x0ZSc6XG4gICAgICAgICAgICByZXR1cm4gbHRlKGxlZnRPcGVyYW5kLCByaWdodE9wZXJhbmQpO1xuICAgICAgICBjYXNlICdhZGQnOlxuICAgICAgICAgICAgcmV0dXJuIGFkZChsZWZ0T3BlcmFuZCwgcmlnaHRPcGVyYW5kKTtcbiAgICAgICAgY2FzZSAnc3ViJzpcbiAgICAgICAgICAgIHJldHVybiBzdWIobGVmdE9wZXJhbmQsIHJpZ2h0T3BlcmFuZCk7XG4gICAgICAgIGNhc2UgJ211bCc6XG4gICAgICAgICAgICByZXR1cm4gbXVsKGxlZnRPcGVyYW5kLCByaWdodE9wZXJhbmQpO1xuICAgICAgICBjYXNlICdkaXYnOlxuICAgICAgICAgICAgcmV0dXJuIGRpdihsZWZ0T3BlcmFuZCwgcmlnaHRPcGVyYW5kKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBuZXcgQmluYXJ5T3BOb2RlKFxuICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICAgICAgYnVpbGRFeHByZXNzaW9uTm9kZShsZWZ0LCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgIGJ1aWxkRXhwcmVzc2lvbk5vZGUocmlnaHQsIHBhcmFtcylcbiAgICAgICAgICAgICk7XG4gICAgfVxufVxuIiwgImltcG9ydCB7IFJlbmRlclByb3BzIH0gZnJvbSAnQGFueXdpZGdldC90eXBlcyc7XG5cbmltcG9ydCB7IHZpekNvb3JkaW5hdG9yIH0gZnJvbSAnLi4vY29vcmRpbmF0b3InO1xuaW1wb3J0IHsgTW9zYWljUXVlcnkgfSBmcm9tICcuLi9jb29yZGluYXRvci9xdWVyeSc7XG5cbmludGVyZmFjZSBEYXRhRnJhbWVQcm9wcyB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBzb3VyY2VfaWQ6IHN0cmluZztcbiAgICBidWZmZXI6IERhdGFWaWV3O1xuICAgIHF1ZXJpZXM6IHN0cmluZztcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVuZGVyKHsgbW9kZWwsIGVsIH06IFJlbmRlclByb3BzPERhdGFGcmFtZVByb3BzPikge1xuICAgIC8vIHVud3JhcCB3aWRnZXQgcGFyYW1ldGVyc1xuICAgIGNvbnN0IGlkID0gbW9kZWwuZ2V0KCdpZCcpO1xuICAgIGNvbnN0IHNvdXJjZV9pZCA9IG1vZGVsLmdldCgnc291cmNlX2lkJyk7XG4gICAgY29uc3QgYnVmZmVyID0gbW9kZWwuZ2V0KCdidWZmZXInKTtcbiAgICBjb25zdCBxdWVyaWVzID0gbW9kZWwuZ2V0KCdxdWVyaWVzJyk7XG4gICAgY29uc3QgZGZRdWVyaWVzOiBNb3NhaWNRdWVyeVtdID0gcXVlcmllcyA/IEpTT04ucGFyc2UocXVlcmllcykgOiBbXTtcblxuICAgIC8vIG1hcmsgY2VsbCBvdXRwdXQgZGl2IGhpZGRlbiBmb3IgbGF5b3V0XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGVsQ2VsbE91dHB1dCA9IGVsLmNsb3Nlc3QoJy5jZWxsLW91dHB1dCcpIGFzIEhUTUxEaXZFbGVtZW50IHwgdW5kZWZpbmVkO1xuICAgICAgICBpZiAoZWxDZWxsT3V0cHV0KSB7XG4gICAgICAgICAgICBlbENlbGxPdXRwdXQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgfVxuICAgIH0sIDEwMCk7XG5cbiAgICAvLyByZWdpc3RlciBkYXRhIGZyYW1lXG4gICAgY29uc3QgY29vcmRpbmF0b3IgPSBhd2FpdCB2aXpDb29yZGluYXRvcigpO1xuICAgIGNvbnN0IGFycm93QnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyLmJ1ZmZlciwgYnVmZmVyLmJ5dGVPZmZzZXQsIGJ1ZmZlci5ieXRlTGVuZ3RoKTtcbiAgICBhd2FpdCBjb29yZGluYXRvci5hZGREYXRhRnJhbWUoaWQsIHNvdXJjZV9pZCwgYXJyb3dCdWZmZXIsIGRmUXVlcmllcyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHsgcmVuZGVyIH07XG4iXSwKICAibWFwcGluZ3MiOiAiO0FBRUE7QUFBQSxFQUVJO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxPQUNHO0FBRVAsU0FBUywwQkFBMEI7OztBQ1RuQztBQUFBLEVBQ0k7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUVBO0FBQUEsT0FDRztBQUVQLGVBQXNCLGFBQWE7QUFDL0IsUUFBTSxtQkFBbUIsbUJBQW1CO0FBRzVDLFFBQU0sU0FBUyxNQUFNLGFBQWEsZ0JBQWdCO0FBRWxELFFBQU0sYUFBYSxJQUFJO0FBQUEsSUFDbkIsSUFBSSxLQUFLLENBQUMsa0JBQWtCLE9BQU8sVUFBVyxLQUFLLEdBQUc7QUFBQSxNQUNsRCxNQUFNO0FBQUEsSUFDVixDQUFDO0FBQUEsRUFDTDtBQUdBLFFBQU0sU0FBUyxJQUFJLE9BQU8sVUFBVTtBQUNwQyxRQUFNLFNBQVMsSUFBSSxjQUFjLFNBQVMsSUFBSTtBQUM5QyxRQUFNLEtBQUssSUFBSSxZQUFZLFFBQVEsTUFBTTtBQUN6QyxRQUFNLEdBQUcsWUFBWSxPQUFPLFlBQVksT0FBTyxhQUFhO0FBQzVELE1BQUksZ0JBQWdCLFVBQVU7QUFFOUIsU0FBTztBQUNYOzs7QUMxQk8s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
